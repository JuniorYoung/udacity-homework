!function(e){function t(a){if(o[a])return o[a].exports;var n=o[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var o={};t.m=e,t.c=o,t.d=function(e,o,a){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s="./src/js/app.js")}({"./src/css/font/iconfont.scss":function(e,t){},"./src/css/main.scss":function(e,t){},"./src/css/normalize.scss":function(e,t){},"./src/js/app.js":function(e,t,o){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}o("./src/css/normalize.scss"),o("./src/css/font/iconfont.scss"),o("./src/css/main.scss");var n=o("./src/js/viewModel.js"),i=a(n),s=o("./src/js/view.js"),r=a(s);window.onload=function(){r.default.init("container"),ko.applyBindings(i.default)}},"./src/js/view.js":function(e,t,o){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}(),i=o("./src/js/viewModel.js"),s=function(e){return e&&e.__esModule?e:{default:e}}(i),r=Symbol("map"),c=Symbol("geolocation"),l=Symbol("place search"),u=Symbol("auto complete"),h=(Symbol("district search"),Symbol("weather")),f=Symbol("user lat lng"),y=Symbol("user city"),p=Symbol("user city code"),d=Symbol("markers"),m=function(){function e(){a(this,e)}return n(e,[{key:"init",value:function(e){var t=this;t[r]=new AMap.Map(e,{resizeEnable:!0}),AMap.plugin(["AMap.Geolocation"],function(){s.default.initOver(!0),t[c]=new AMap.Geolocation({timeout:4e3,showCircle:!0,GeoLocationFirst:!0,extensions:"all",buttonPosition:"RB"}),t[r].addControl(t[c]),t[c].getCurrentPosition(),AMap.event.addListener(t[c],"complete",function(e){e.addressComponent&&e.addressComponent.citycode?(t[f]=e.position,t[p]=e.addressComponent.citycode,t[y]=e.addressComponent.city,t.initLocationTypes()):t.geoLocationError()}),AMap.event.addListener(t[c],"error",function(e){"NOT_SUPPORTED"===e.info?alert("当前浏览器不支持定位功能"):"FAILED"===e.info&&(alert("定位失败"),t.geoLocationError())})}),t.registerEvent()}},{key:"geoLocationError",value:function(){var e=this;e[r].getCity(function(t){e[p]=t.citycode,e[f]=e[r].getCenter(),e[y]=t.city,e.initLocationTypes()})}},{key:"loadWeather",value:function(){var e=this;AMap.plugin("AMap.Weather",function(){e[h]=new AMap.Weather,e[h].getForecast(e[y],function(e,t){if(null===e){s.default.showWeather(!0);var o=t.forecasts[0];s.default.dayTemp(o.dayTemp),s.default.nightTemp(o.nightTemp),s.default.weather(o.dayWeather)}})})}},{key:"initLocationTypes",value:function(){s.default.city(this[y]),this.loadWeather();var e=[{name:"住宿",alias:"住宿服务"},{name:"餐饮",alias:"餐饮服务"},{name:"购物",alias:"购物服务"},{name:"商务住宅",alias:"商务住宅"}];s.default.locationTypes(e),this.placeSearch(!0,e[0].alias,"")}},{key:"autoComplete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===e)s.default.showLocations(!0),s.default.showAutoComplete(!1);else{var t=this;void 0===t[u]?AMap.plugin("AMap.Autocomplete",function(){document.getElementById("searchTip");t[u]=new AMap.Autocomplete({city:t[p],citylimit:!0}),t.autoCompleteCommon(e)}):t.autoCompleteCommon(e)}}},{key:"autoCompleteCommon",value:function(e){var t=this;t[u].search(e,function(e,o){"complete"===e?(s.default.showAutoComplete(!0),s.default.showSearchHistory(!1),s.default.autoCompleteRes(o.tips)):"error"===e||"no_data"===e&&t.hidePanel()})}},{key:"placeSearch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";s.default.showLocations(!0),s.default.changeSearchTextByHistory=!1,s.default.showAutoComplete(!1),s.default.showSearchHistory(!1),s.default.activeLocationType(t);var a=this;void 0===a[l]?AMap.plugin("AMap.PlaceSearch",function(){a[l]=new AMap.PlaceSearch({type:t,map:a[r],pageSize:5,city:a[p],citylimit:!0,panel:"searchedLocationUl",autoFitView:!0}),a.placeSearchCommon(e,o),AMap.event.addListener(a[l],"listElementClick",function(e){var t=e.index,o=a[d][t];o.setAnimation("AMAP_ANIMATION_BOUNCE"),setTimeout(function(){o.setAnimation("AMAP_ANIMATION_NONE")},1e3)})}):(a[l].setType(t),a[l].setPageIndex(1),a.placeSearchCommon(e,o))}},{key:"placeSearchCommon",value:function(e,t){var o=this;e?o[l].searchNearBy(t,o[f],3e3,function(e,t){o.autoAreaListHeight(),o[d]=o[r].getAllOverlays("marker")}):o[l].search(t,function(e,t){o.autoAreaListHeight(),o[d]=o[r].getAllOverlays("marker")})}},{key:"registerEvent",value:function(){var e=this;window.onresize=function(){var t=void 0;t&&clearTimeout(t),t=setTimeout(function(){e.autoAreaListHeight()},500)},e[r].on("touchstart",function(t){e.hidePanel()}),e[r].on("dragend",function(){e.hidePanel()})}},{key:"hidePanel",value:function(){s.default.showAutoComplete(!1),s.default.showLocations(!1),s.default.showSearchHistory(!1)}},{key:"autoAreaListHeight",value:function(){var e=document.body.clientHeight,t=e-120,o=document.getElementsByClassName("amap_lib_placeSearch")[0].clientHeight;document.getElementById("searchedLocationUl").style.maxHeight=o&&o>t?t+"px":o+"px"}}]),e}(),v=new m;t.default=v},"./src/js/viewModel.js":function(e,t,o){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}(),i=o("./src/js/view.js"),s=function(e){return e&&e.__esModule?e:{default:e}}(i),r=function(){function e(){a(this,e);var t=this;this.initOver=ko.observable(!1),this.showWeather=ko.observable(!1),this.city=ko.observable(""),this.weather=ko.observable(""),this.dayTemp=ko.observable(""),this.nightTemp=ko.observable(""),this.activeLocationType=ko.observable(""),this.searchText=ko.observable(""),this.locationTypes=ko.observableArray([]),this.showLocations=ko.observable(!1),this.showAutoComplete=ko.observable(!1),this.showSearchHistory=ko.observable(!1),this.changeSearchTextByHistory=!1,this.autoCompleteRes=ko.observableArray([]),this.searchHistory=ko.observableArray(JSON.parse(localStorage.getItem("searchHistory")||"[]")),this.searchText.subscribe(function(e){t.changeSearchTextByHistory||s.default.autoComplete(e)})}return n(e,[{key:"switchLocationType",value:function(e){var t=(e.name,e.alias);s.default.placeSearch(!0,t,"")}},{key:"searchLocalHistory",value:function(e){this.changeSearchTextByHistory=!0,this.searchText(e),this.search()}},{key:"search",value:function(){var e=this.searchText();0!=e.trim().length&&(this.searchHistory.remove(e),this.searchHistory.unshift(e),localStorage.setItem("searchHistory",JSON.stringify(this.searchHistory())),s.default.placeSearch(!1,"",this.searchText()))}},{key:"searchFocus",value:function(){if(""===this.searchText().trim()){null!==localStorage.getItem("searchHistory")?this.showSearchHistory(!0):this.showLocations(!0)}else this.showLocations(!0),this.showAutoComplete(!1),this.showSearchHistory(!1)}},{key:"clearHistory",value:function(){this.showSearchHistory(!1),this.searchHistory([]),localStorage.removeItem("searchHistory")}}]),e}(),c=new r;t.default=c}});